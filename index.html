<!DOCTYPE html>
<html>
<head>
    <title>Space Builder: Ultimate</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background: #000; color: white; touch-action: none; }
        
        /* BUILDER SCREEN */
        #build-screen { display: flex; flex-direction: column; height: 100vh; background: #050505; position: relative; z-index: 100; }
        
        #blueprint-area { 
            flex-grow: 1; 
            position: relative; 
            background: radial-gradient(#1a1a1a 1px, transparent 1px) 0 0/25px 25px; 
            border-bottom: 2px solid #00ff00; 
            overflow: hidden;
        }

        #menu-container { height: 45%; display: flex; flex-direction: column; background: #111; }
        
        .scroll-arrow { height: 35px; background: #222; color: #00ff00; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        
        #parts-menu { 
            flex-grow: 1; 
            overflow-y: hidden; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            padding: 10px; 
            scroll-behavior: smooth; 
        }

        .part-btn { background: #16213e; color: white; border: 1px solid #00ff00; padding: 15px; font-size: 11px; font-weight: bold; border-radius: 4px; }
        .launch-btn { background: #008000; grid-column: span 2; padding: 15px; border: 1px solid white; font-size: 16px; font-weight: bold; }
        
        /* DELETE BAR (Matches your screenshot) */
        #delete-bar { background: #800; color: white; padding: 12px; text-align: center; font-weight: bold; cursor: pointer; border-top: 2px solid red; }

        /* THE VISUAL ROCKET PARTS */
        .placed-part { 
            width: 80px; 
            position: absolute; 
            left: 50%; 
            transform: translateX(-50%); 
            border: 1px solid #fff; 
            color: black; 
            font-weight: bold; 
            font-size: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            transition: bottom 0.2s;
        }

        /* HUD & FLIGHT UI */
        #hud { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 200; }
        .hud-panel { position: absolute; background: rgba(0,0,0,0.8); border: 1px solid #00ff00; pointer-events: auto; padding: 10px; border-radius: 5px; }
        
        #landing-cam { bottom: 20px; left: 20px; width: 120px; height: 120px; border: 2px solid red; }
        
        #rcs-pad { position: absolute; bottom: 160px; left: 20px; display: grid; grid-template-columns: 45px 45px 45px; gap: 5px; pointer-events: auto; }
        .rcs-btn { width: 45px; height: 45px; background: rgba(0,255,0,0.2); border: 1px solid #00ff00; color: #00ff00; font-weight: bold; }

        #controls-right { position: absolute; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 15px; pointer-events: auto; }
        .fire-btn { width: 100px; height: 100px; border-radius: 50%; background: rgba(255,0,0,0.6); border: 4px solid red; color: white; font-weight: bold; font-size: 18px; }
        .spec-btn { width: 100px; height: 45px; background: #333; border: 1px solid white; color: white; border-radius: 25px; display: none; }
    </style>
</head>
<body>

    <div id="build-screen">
        <div id="blueprint-area">
            <div style="padding:15px; font-weight: bold; color: #00ff00; font-size: 18px;">BUDGET: $<span id="cash">10000</span></div>
            </div>

        <div id="menu-container">
            <button class="scroll-arrow" onclick="scrollMenu(-100)">▲ SCROLL UP</button>
            <div id="parts-menu">
                <button class="part-btn" onclick="addPart('capsule')">CAPSULE ($200)</button>
                <button class="part-btn" onclick="addPart('fairing')">FAIRING+ROVER ($1000)</button>
                <button class="part-btn" onclick="addPart('antenna')">ANTENNA TANK ($600)</button>
                <button class="part-btn" onclick="addPart('fuel')">FUEL TANK ($300)</button>
                <button class="part-btn" onclick="addPart('booster')">BOOSTER ($400)</button>
                <button class="part-btn" onclick="addPart('decoupler')">DECOUPLER ($300)</button>
                <button class="part-btn" onclick="addPart('shield')">HEAT SHIELD ($500)</button>
                <button class="part-btn" onclick="addPart('chute')">PARACHUTE ($400)</button>
                <button class="part-btn launch-btn" onclick="launch()">INITIALIZE LAUNCH</button>
            </div>
            <button class="scroll-arrow" onclick="scrollMenu(100)">▼ SCROLL DOWN</button>
            <div id="delete-bar" onclick="undo()">DELETE LAST PART</div>
        </div>
    </div>

    <div id="hud">
        <div id="rcs-pad">
            <div></div><button class="rcs-btn" onmousedown="rcs('z',-0.1)" onmouseup="rcs('z',0)">W</button><div></div>
            <button class="rcs-btn" onmousedown="rcs('x',-0.1)" onmouseup="rcs('x',0)">A</button>
            <button class="rcs-btn" onmousedown="rcs('z',0.1)" onmouseup="rcs('z',0)">S</button>
            <button class="rcs-btn" onmousedown="rcs('x',0.1)" onmouseup="rcs('x',0)">D</button>
        </div>

        <div id="landing-cam" class="hud-panel"><canvas id="l-canvas" width="120" height="120"></canvas></div>

        <div id="controls-right">
            <button id="stage-btn" class="spec-btn" style="background:orange; color:black" onclick="alert('Stage Separated!')">STAGE</button>
            <button id="fire-btn" class="fire-btn">IGNITION</button>
        </div>
    </div>

    <a-scene id="game-scene" style="display:none">
        <a-sky id="sky" color="#87CEEB"></a-sky>
        <a-cylinder position="0 -1 0" radius="500" height="2" color="#222"></a-cylinder>
        
        <a-entity id="rocket-rig">
            <a-entity id="visual-stack"></a-entity>
            <a-entity id="flame" geometry="primitive:cone; radiusBottom:0.5; height:2" material="color:orange" position="0 -2 0" rotation="180 0 0" visible="false"></a-entity>
        </a-entity>

        <a-entity id="cam-pivot">
            <a-entity position="0 5 20"><a-camera look-controls="enabled:false"></a-camera></a-entity>
        </a-entity>
    </a-scene>

    <script>
        const PARTS_DB = {
            'capsule': {h:40, h3:1.5, cost:200, col:'#fff', label:'CAPSULE'},
            'fairing': {h:35, h3:1.8, cost:1000, col:'#ddd', label:'FAIRING'},
            'antenna': {h:60, h3:2.2, cost:600, col:'#f90', label:'ANTENNA'},
            'fuel': {h:60, h3:2.2, cost:300, col:'#f90', label:'FUEL'},
            'booster': {h:50, h3:1.8, cost:400, col:'#444', label:'BOOSTER'},
            'decoupler': {h:15, h3:0.4, cost:300, col:'#ffff00', label:'STAGING'},
            'shield': {h:12, h3:0.3, cost:500, col:'#222', label:'SHIELD'},
            'chute': {h:20, h3:0.6, cost:400, col:'#f00', label:'CHUTE'}
        };

        let stack = []; let cash = 10000; let buildY = 10;
        let pos = {x:0, y:1, z:0}; let vel = {x:0, y:0, z:0};
        let active = false; let camRot = 0; let lastX = 0; let swiping = false;

        function scrollMenu(a) { document.getElementById('parts-menu').scrollBy({top:a, behavior:'smooth'}); }

        function addPart(type) {
            if(cash < PARTS_DB[type].cost) return;
            cash -= PARTS_DB[type].cost;
            
            let el = document.createElement('div');
            el.className = 'placed-part';
            el.id = 'p-' + stack.length;
            el.style.backgroundColor = PARTS_DB[type].col;
            el.style.height = PARTS_DB[type].h + 'px';
            el.style.bottom = buildY + 'px';
            el.innerText = PARTS_DB[type].label;
            
            document.getElementById('blueprint-area').appendChild(el);
            stack.push(type);
            buildY += PARTS_DB[type].h;
            document.getElementById('cash').innerText = cash;
        }

        function undo() {
            if(stack.length === 0) return;
            let type = stack.pop();
            cash += PARTS_DB[type].cost;
            buildY -= PARTS_DB[type].h;
            document.getElementById('p-' + stack.length).remove();
            document.getElementById('cash').innerText = cash;
        }

        function launch() {
            if(!stack.includes('capsule')) return alert("Add a Capsule!");
            document.getElementById('build-screen').style.display = 'none';
            document.getElementById('game-scene').style.display = 'block';
            document.getElementById('hud').style.display = 'block';
            
            let v = document.getElementById('visual-stack');
            let currentY = 0;
            stack.forEach(type => {
                let e = document.createElement('a-entity');
                e.setAttribute('geometry', `primitive:cylinder; radius:0.8; height:${PARTS_DB[type].h3}`);
                e.setAttribute('material', `color:${PARTS_DB[type].col}`);
                e.setAttribute('position', `0 ${currentY + PARTS_DB[type].h3/2} 0`);
                v.appendChild(e);
                currentY += PARTS_DB[type].h3;
            });
            if(stack.includes('decoupler')) document.getElementById('stage-btn').style.display = 'block';
            active = true; loop();
        }

        function rcs(axis, v) { if(active) vel[axis] += v; }

        window.addEventListener('mousedown', (e) => { swiping = true; lastX = e.clientX; });
        window.addEventListener('mousemove', (e) => {
            if(swiping) { camRot -= (e.clientX - lastX) * 0.5; lastX = e.clientX; }
        });
        window.addEventListener('mouseup', () => swiping = false);

        function loop() {
            if(!active) return;
            let thrust = document.getElementById('fire-btn').dataset.press === 'true';
            if(thrust) { vel.y += 0.08; document.getElementById('flame').setAttribute('visible', true); }
            else { document.getElementById('flame').setAttribute('visible', false); }
            
            vel.y -= 0.04; pos.y += vel.y; pos.x += vel.x; pos.z += vel.z;
            if(pos.y < 1) { pos.y = 1; vel.y = 0; vel.x *= 0.7; vel.z *= 0.7; }

            document.getElementById('rocket-rig').setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
            document.getElementById('cam-pivot').setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
            document.getElementById('cam-pivot').setAttribute('rotation', `0 ${camRot} 0`);

            let lc = document.getElementById('landing-cam');
            lc.style.display = (pos.y < 100 && vel.y < 0) ? 'block' : 'none';
            if(lc.style.display === 'block') drawCam();

            requestAnimationFrame(loop);
        }

        function drawCam() {
            let ctx = document.getElementById('l-canvas').getContext('2d');
            ctx.fillStyle = '#111'; ctx.fillRect(0,0,120,120);
            ctx.strokeStyle = '#0f0'; ctx.beginPath();
            ctx.arc(60,60, Math.max(2, 50 - pos.y/2), 0, Math.PI*2); ctx.stroke();
        }

        const fb = document.getElementById('fire-btn');
        fb.onmousedown = () => fb.dataset.press = 'true';
        fb.onmouseup = () => fb.dataset.press = 'false';
        fb.ontouchstart = (e) => { e.preventDefault(); fb.dataset.press = 'true'; };
        fb.ontouchend = () => fb.dataset.press = 'false';
    </script>
</body>
</html>
