<!DOCTYPE html>
<html>
<head>
    <title>Space Builder: Mars Explorer</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { font-family: 'Courier New', monospace; margin: 0; overflow: hidden; background: black; color: lime; }
        
        /* BUILDER INTERFACE */
        #build-screen { display: flex; flex-direction: column; height: 100vh; background: #0a0a1a; }
        #blueprint-area { flex-grow: 1; position: relative; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; border-bottom: 2px solid lime; }
        #parts-menu { height: 40%; overflow-y: scroll; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; background: #16213e; }
        
        .part-btn { background: #0f3460; color: white; border: 1px solid lime; padding: 12px; font-size: 11px; text-align: center; cursor: pointer; }
        .del-btn { background: #600; border-color: red; color: white; grid-column: span 2; font-weight: bold; }
        
        .placed-part { width: 60px; position: absolute; left: 50%; transform: translateX(-50%); border: 1px solid white; color: black; font-weight: bold; font-size: 9px; text-align: center; }

        /* FLIGHT HUD */
        #mobile-hud { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-panel { position: absolute; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid lime; pointer-events: auto; }
        #crew-status { top: 10px; left: 10px; width: 150px; }
        .o2-bg { width: 100%; height: 6px; background: #222; border: 1px solid #555; margin-top: 2px; }
        .o2-fill { height: 100%; background: #00f2ff; width: 100%; }
        
        #controls { bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-btn { width: 70px; height: 70px; background: rgba(0,255,0,0.2); border: 2px solid lime; color: lime; border-radius: 50%; font-weight: bold; pointer-events: auto; }
    </style>
</head>
<body>

    <div id="build-screen">
        <div id="blueprint-area">
            <div style="padding: 15px;">
                <h3 style="margin:0;">ROCKET BUILDER</h3>
                <p style="font-size:12px;">CASH: $<span id="money-display">1000</span> | O2: <span id="o2-total">0</span>s</p>
                <button onclick="launch()" style="background:red; color:white; border:none; padding:10px; width:100%; font-weight:bold;">LAUNCH TO MARS</button>
            </div>
        </div>
        <div id="parts-menu">
            <button class="part-btn" onclick="addPart('capsule')">CAPSULE ($200)</button>
            <button class="part-btn" onclick="addPart('booster')">BOOSTER ($400)</button>
            <button class="part-btn" onclick="addPart('rcs')">RCS ($100)</button>
            <button class="part-btn" onclick="addPart('oxygen')">O2 TANK ($150)</button>
            <button class="part-btn del-btn" onclick="deleteLastPart()">DELETE LAST PART</button>
        </div>
    </div>

    <div id="mobile-hud">
        <div id="crew-status" class="hud-panel">
            <div style="font-size:10px; margin-bottom:5px;">FUEL: <span id="fuel-display">0</span></div>
            <div style="font-size:10px;">ASTRO 1 <div class="o2-bg"><div id="o2-1" class="o2-fill"></div></div></div>
            <div style="font-size:10px;">ASTRO 2 <div class="o2-bg"><div id="o2-2" class="o2-fill"></div></div></div>
            <div style="font-size:10px;">ASTRO 3 <div class="o2-bg"><div id="o2-3" class="o2-fill"></div></div></div>
        </div>
        <div id="controls">
            <button id="thrust-btn" class="ctrl-btn">THRUST</button>
        </div>
    </div>

    <a-scene id="game-scene" style="display:none">
        <a-assets>
            <a-mixin id="m-capsule" geometry="primitive: cone; radiusBottom: 0.8; height: 1.5" material="color: white"></a-mixin>
            <a-mixin id="m-booster" geometry="primitive: cylinder; radius: 0.8; height: 2" material="color: #666"></a-mixin>
            <a-mixin id="m-rcs" geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" material="color: white"></a-mixin>
            <a-mixin id="m-oxygen" geometry="primitive: cylinder; radius: 0.4; height: 1" material="color: cyan"></a-mixin>
            <a-mixin id="m-bacteria" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" material="color: #7FFF00"></a-mixin>
        </a-assets>

        <a-entity id="blackhole" position="0 0 -2000">
            <a-sphere radius="40" color="black"></a-sphere>
            <a-ring radius-inner="42" radius-outer="70" rotation="-90 0 0" color="#30f"></a-ring>
        </a-entity>

        <a-entity id="whitehole" position="0 0 2000">
            <a-sphere radius="40" color="white"></a-sphere>
        </a-entity>

        <a-entity id="mars" position="0 -50 -500">
            <a-sphere radius="50" color="#ff4400"></a-sphere>
            <a-sphere position="0 -49.5 0" radius="15" scale="1 0.1 1" color="white">
                <a-entity mixin="m-bacteria" position="1 0.5 1"></a-entity>
                <a-entity mixin="m-bacteria" position="-1 0.5 2"></a-entity>
            </a-sphere>
        </a-entity>

        <a-sky color="black"></a-sky>
        <a-entity id="rocket-group" position="0 5 0"></a-entity>
        <a-entity id="camera-rig" position="0 10 30"><a-camera look-controls></a-camera></a-entity>
    </a-scene>

    <script>
        let parts = [];
        let currentH = 20;
        let money = 1000;
        let o2Capacity = 0;
        let fuelCapacity = 0;

        const partSpecs = {
            'capsule': {h: 40, h3d: 1.5, cost: 200, o2: 100, fuel: 0, color: 'white'},
            'booster': {h: 60, h3d: 2.0, cost: 400, o2: 0, fuel: 1000, color: '#666'},
            'rcs':     {h: 20, h3d: 0.5, cost: 100, o2: 0, fuel: 100, color: 'white'},
            'oxygen':  {h: 30, h3d: 1.0, cost: 150, o2: 500, fuel: 0, color: 'cyan'}
        };

        function addPart(t) {
            let p = partSpecs[t];
            if(money < p.cost) return alert("No Money!");

            let el = document.createElement('div');
            el.className = 'placed-part';
            el.style.height = p.h + 'px';
            el.style.backgroundColor = p.color;
            el.style.bottom = currentH + 'px';
            el.innerText = t;
            document.getElementById('blueprint-area').appendChild(el);

            parts.push(t);
            money -= p.cost;
            currentH += p.h;
            o2Capacity += p.o2;
            fuelCapacity += p.fuel;
            updateBuildUI();
        }

        function deleteLastPart() {
            if (parts.length === 0) return;
            
            // Remove the part from the array
            let lastType = parts.pop();
            let p = partSpecs[lastType];

            // Remove visual from blueprint
            let area = document.getElementById('blueprint-area');
            area.removeChild(area.lastElementChild);

            // Refund money and reset stats
            money += p.cost;
            currentH -= p.h;
            o2Capacity -= p.o2;
            fuelCapacity -= p.fuel;
            updateBuildUI();
        }

        function updateBuildUI() {
            document.getElementById('money-display').innerText = money;
            document.getElementById('o2-total').innerText = o2Capacity;
        }

        let isFlying = false;
        let rocketPos = {y: 5, z: 0};
        let velocity = 0;
        let isThrusting = false;
        let currentO2 = [0,0,0];

        function launch() {
            if(parts.indexOf('capsule') === -1) return alert("Needs a Capsule!");
            currentO2 = [o2Capacity, o2Capacity, o2Capacity];
            document.getElementById('build-screen').style.display = 'none';
            document.getElementById('game-scene').style.display = 'block';
            document.getElementById('mobile-hud').style.display = 'block';
            
            let group = document.getElementById('rocket-group');
            let drawY = 0;
            parts.forEach(t => {
                let ent = document.createElement('a-entity');
                ent.setAttribute('mixin', 'm-'+t);
                ent.setAttribute('position', `0 ${drawY} 0`);
                group.appendChild(ent);
                drawY += partSpecs[t].h3d;
            });
            isFlying = true;
            gameLoop();
        }

        function gameLoop() {
            if(!isFlying) return;

            if(isThrusting && fuelCapacity > 0) {
                velocity += 0.05; fuelCapacity -= 2;
            } else {
                velocity -= 0.02;
            }
            rocketPos.y += velocity;
            if(rocketPos.y < 5) { rocketPos.y = 5; velocity = 0; }

            // 3 Astronaut Oxygen Logic
            for(let i=0; i<3; i++) {
                if(currentO2[i] > 0) {
                    currentO2[i] -= 0.2;
                    let pct = (currentO2[i]/o2Capacity)*100;
                    document.getElementById('o2-'+(i+1)).style.width = pct + '%';
                }
            }

            document.getElementById('rocket-group').setAttribute('position', `0 ${rocketPos.y} ${rocketPos.z}`);
            document.getElementById('camera-rig').setAttribute('position', `0 ${rocketPos.y+5} ${rocketPos.z+30}`);
            document.getElementById('fuel-display').innerText = Math.floor(fuelCapacity);
            requestAnimationFrame(gameLoop);
        }

        const tBtn = document.getElementById('thrust-btn');
        tBtn.addEventListener('touchstart', () => isThrusting = true);
        tBtn.addEventListener('touchend', () => isThrusting = false);
    </script>
</body>
</html>
