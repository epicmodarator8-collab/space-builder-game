<!DOCTYPE html>
<html>
  <head>
    <title>Space Builder Multiplayer</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    
    <a-scene>
      
      <a-assets>
        <a-mixin id="dome" geometry="primitive: sphere; thetaLength: 90" material="color: white; opacity: 0.8; side: double" scale="2 2 2"></a-mixin>
        <a-mixin id="bed" geometry="primitive: box; depth: 2; height: 0.5; width: 1" material="color: gray"></a-mixin>
        <a-mixin id="flag" geometry="primitive: cylinder; height: 3; radius: 0.05" material="color: silver"></a-mixin>
      </a-assets>

      <a-entity environment="preset: mars; skyType: atmosphere; lighting: point"></a-entity>

      <a-entity id="astronaut" position="0 1.6 0" wasd-controls look-controls>
        <a-entity camera position="0 0 0">
           <a-entity cursor="fuse: false; fuseTimeout: 500"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: cyan; shader: flat">
           </a-entity>
           <a-text value="O2: 100%" position="-1 0.7 -1" scale="0.5 0.5 0.5" color="white"></a-text>
        </a-entity>
      </a-entity>

      <a-plane position="0 0.1 0" rotation="-90 0 0" width="100" height="100" color="red" opacity="0.001" class="ground"></a-plane>

    </a-scene>

    <script>
      // 1. Select the ground
      var ground = document.querySelector('.ground');
      var scene = document.querySelector('a-scene');
      
      // 2. Variable to track what we are building
      var currentBuildItem = 'dome'; // Default item

      // 3. Listen for a click on the ground
      ground.addEventListener('click', function (evt) {
        
        // Create a new 3D entity
        var newItem = document.createElement('a-entity');
        
        // Set its position to where you clicked
        newItem.setAttribute('position', evt.detail.intersection.point);
        
        // Apply the shape based on your notes
        newItem.setAttribute('mixin', currentBuildItem);

        // Add the Flag top if it is a flag
        if(currentBuildItem === 'flag') {
            var flagTop = document.createElement('a-box');
            flagTop.setAttribute('color', 'red');
            flagTop.setAttribute('position', '0 1.5 0.5');
            flagTop.setAttribute('scale', '0.1 0.5 0.8');
            newItem.appendChild(flagTop);
        }

        // Add it to the world
        scene.appendChild(newItem);
        console.log("Built a " + currentBuildItem);
      });

      // 4. Keyboard shortcuts to switch items (1, 2, 3)
      window.addEventListener('keydown', function(e){
        if(e.key === '1') { currentBuildItem = 'dome'; alert("Selected: Dome"); }
        if(e.key === '2') { currentBuildItem = 'bed'; alert("Selected: Bed"); }
        if(e.key === '3') { currentBuildItem = 'flag'; alert("Selected: Flag"); }
      });

    </script>
  </body>
</html>
