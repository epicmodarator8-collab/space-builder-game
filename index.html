<!DOCTYPE html>
<html>
<head>
    <title>Space Builder: Arrow Control</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { font-family: 'Courier New', monospace; margin: 0; overflow: hidden; background: black; color: lime; }
        
        /* BUILDER INTERFACE */
        #build-screen { display: flex; flex-direction: column; height: 100vh; background: #0a0a1a; }
        #blueprint-area { flex-grow: 1; position: relative; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; border-bottom: 2px solid lime; }
        #parts-menu { height: 45%; overflow-y: scroll; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; background: #16213e; }
        .part-btn { background: #0f3460; color: white; border: 1px solid lime; padding: 12px; font-size: 11px; text-align: center; cursor: pointer; }
        .del-btn { background: #600; border-color: red; color: white; grid-column: span 2; font-weight: bold; }
        .placed-part { width: 60px; position: absolute; left: 50%; transform: translateX(-50%); border: 1px solid white; color: black; font-weight: bold; font-size: 9px; text-align: center; display: flex; align-items: center; justify-content: center; }

        /* FLIGHT HUD */
        #mobile-hud { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-panel { position: absolute; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid lime; pointer-events: auto; }
        #crew-status { top: 10px; left: 10px; width: 160px; }
        .o2-bg { width: 100%; height: 6px; background: #222; border: 1px solid #555; margin-top: 2px; }
        .o2-fill { height: 100%; background: #00f2ff; width: 100%; }
        
        /* ARROW KEY CONTROLS */
        #dpad { position: absolute; bottom: 20px; left: 20px; display: grid; grid-template-columns: 60px 60px 60px; gap: 5px; pointer-events: auto; }
        #thrust-zone { position: absolute; bottom: 20px; right: 20px; pointer-events: auto; }
        .ctrl-btn { width: 60px; height: 60px; background: rgba(0,255,0,0.2); border: 2px solid lime; color: lime; font-weight: bold; border-radius: 10px; }
        .thrust-btn { width: 80px; height: 80px; border-radius: 50%; background: rgba(255,0,0,0.3); border: 2px solid red; color: white; }
    </style>
</head>
<body>

    <div id="build-screen">
        <div id="blueprint-area">
            <div style="padding: 15px;">
                <h3 style="margin:0; color:lime;">ROCKET BUILDER</h3>
                <p style="font-size:12px;">CASH: $<span id="money-display">1000</span> | MASS: <span id="mass-display">0</span>t</p>
                <button onclick="launch()" style="background:red; color:white; border:none; padding:12px; width:100%; font-weight:bold; cursor:pointer;">LAUNCH MISSION</button>
            </div>
        </div>
        <div id="parts-menu">
            <button class="part-btn" onclick="addPart('capsule')">CAPSULE ($200)</button>
            <button class="part-btn" onclick="addPart('booster')">BOOSTER ($400)</button>
            <button class="part-btn" onclick="addPart('fuel_tank')">FUEL TANK ($300)</button>
            <button class="part-btn" onclick="addPart('oxygen')">O2 TANK ($150)</button>
            <button class="part-btn" onclick="addPart('rcs')">RCS ($100)</button>
            <button class="part-btn del-btn" onclick="deleteLastPart()">DELETE LAST PART</button>
        </div>
    </div>

    <div id="mobile-hud">
        <div id="crew-status" class="hud-panel">
            <div style="font-size:11px; color:orange; margin-bottom:5px;">FUEL: <span id="fuel-display">0</span>L</div>
            <div style="font-size:10px;">ASTRO 1 <div class="o2-bg"><div id="o2-1" class="o2-fill"></div></div></div>
            <div style="font-size:10px;">ASTRO 2 <div class="o2-bg"><div id="o2-2" class="o2-fill"></div></div></div>
            <div style="font-size:10px;">ASTRO 3 <div class="o2-bg"><div id="o2-3" class="o2-fill"></div></div></div>
        </div>

        <div id="dpad">
            <div></div><button class="ctrl-btn" id="btn-up">▲</button><div></div>
            <button class="ctrl-btn" id="btn-left">◀</button><div></div><button class="ctrl-btn" id="btn-right">▶</button>
            <div></div><button class="ctrl-btn" id="btn-down">▼</button><div></div>
        </div>

        <div id="thrust-zone">
            <button id="thrust-btn" class="ctrl-btn thrust-btn">FIRE</button>
        </div>
    </div>

    <a-scene id="game-scene" style="display:none">
        <a-assets>
            <a-mixin id="m-capsule" geometry="primitive: cone; radiusBottom: 0.8; height: 1.5" material="color: white"></a-mixin>
            <a-mixin id="m-booster" geometry="primitive: cylinder; radius: 0.9; height: 1.0" material="color: #333"></a-mixin>
            <a-mixin id="m-fuel_tank" geometry="primitive: cylinder; radius: 0.8; height: 2.0" material="color: orange"></a-mixin>
            <a-mixin id="m-rcs" geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" material="color: white"></a-mixin>
            <a-mixin id="m-oxygen" geometry="primitive: cylinder; radius: 0.4; height: 1" material="color: cyan"></a-mixin>
            <a-mixin id="m-bacteria" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" material="color: #7FFF00"></a-mixin>
        </a-assets>

        <a-entity id="blackhole" position="0 0 -2000"><a-sphere radius="50" color="black"></a-sphere></a-entity>
        <a-entity id="whitehole" position="0 0 2000"><a-sphere radius="50" color="white"></a-sphere></a-entity>
        <a-entity id="mars" position="0 -50 -600"><a-sphere radius="60" color="#ff4400"></a-sphere>
            <a-sphere position="0 -59.5 0" radius="20" scale="1 0.1 1" color="white">
                <a-entity mixin="m-bacteria" position="2 0.5 2"></a-entity>
            </a-sphere>
        </a-entity>

        <a-sky color="black"></a-sky>
        <a-entity id="rocket-group" position="0 5 0">
            <a-entity id="flame" geometry="primitive:cone; height:1.5; radiusBottom:0.5" material="color:yellow" position="0 -1.5 0" rotation="180 0 0" visible="false"></a-entity>
        </a-entity>
        <a-entity id="camera-rig" position="0 10 30"><a-camera look-controls="enabled: false"></a-camera></a-entity>
    </a-scene>

    <script>
        let parts = []; let currentH = 20; let money = 1000;
        let stats = { o2: 0, fuel: 0, mass: 0 };
        const partSpecs = {
            'capsule':   {h: 40, h3d: 1.5, cost: 200, o2: 100, fuel: 0,    mass: 10, color: 'white'},
            'booster':   {h: 30, h3d: 1.0, cost: 400, o2: 0,   fuel: 100,  mass: 15, color: '#333'},
            'fuel_tank': {h: 60, h3d: 2.0, cost: 300, o2: 0,   fuel: 1500, mass: 25, color: 'orange'},
            'rcs':       {h: 20, h3d: 0.5, cost: 100, o2: 0,   fuel: 50,   mass: 5,  color: 'white'},
            'oxygen':    {h: 30, h3d: 1.0, cost: 150, o2: 500, fuel: 0,    mass: 8,  color: 'cyan'}
        };

        function addPart(t) {
            let p = partSpecs[t]; if(money < p.cost) return;
            let el = document.createElement('div'); el.className = 'placed-part';
            el.style.height = p.h + 'px'; el.style.backgroundColor = p.color;
            el.style.bottom = currentH + 'px'; el.innerText = t.toUpperCase();
            document.getElementById('blueprint-area').appendChild(el);
            parts.push(t); money -= p.cost; currentH += p.h; stats.o2 += p.o2; stats.fuel += p.fuel; stats.mass += p.mass; updateUI();
        }

        function deleteLastPart() {
            if (parts.length === 0) return;
            let p = partSpecs[parts.pop()]; document.getElementById('blueprint-area').removeChild(document.getElementById('blueprint-area').lastElementChild);
            money += p.cost; currentH -= p.h; stats.o2 -= p.o2; stats.fuel -= p.fuel; stats.mass -= p.mass; updateUI();
        }

        function updateUI() { document.getElementById('money-display').innerText = money; document.getElementById('mass-display').innerText = stats.mass; }

        let isFlying = false; let rPos = {x: 0, y: 5, z: 0}; let rVel = {x: 0, y: 0, z: 0};
        let input = { fwd: false, back: false, left: false, right: false, thrust: false };

        function launch() {
            if(parts.indexOf('capsule') === -1) return;
            currentO2 = [stats.o2, stats.o2, stats.o2];
            document.getElementById('build-screen').style.display = 'none';
            document.getElementById('game-scene').style.display = 'block';
            document.getElementById('mobile-hud').style.display = 'block';
            let group = document.getElementById('rocket-group'); let drawY = 0;
            parts.forEach(t => {
                let ent = document.createElement('a-entity'); ent.setAttribute('mixin', 'm-'+t);
                ent.setAttribute('position', `0 ${drawY} 0`); group.appendChild(ent); drawY += partSpecs[t].h3d;
            });
            isFlying = true; gameLoop();
        }

        function gameLoop() {
            if(!isFlying) return;
            // Controls Logic
            if(input.thrust && stats.fuel > 0) { rVel.y += 0.05; stats.fuel -= 1; document.getElementById('flame').setAttribute('visible', 'true'); }
            else { rVel.y -= 0.02; document.getElementById('flame').setAttribute('visible', 'false'); }
            
            if(input.fwd) rVel.z -= 0.1; if(input.back) rVel.z += 0.1;
            if(input.left) rVel.x -= 0.1; if(input.right) rVel.x += 0.1;

            // Physics
            if(rPos.z < -1000) rVel.z -= 0.05; // Black Hole Pull
            if(rPos.z > 1500) rVel.z -= 0.5;   // White Hole Push
            
            rPos.x += rVel.x; rPos.y += rVel.y; rPos.z += rVel.z;
            rVel.x *= 0.95; rVel.z *= 0.95; // Friction
            if(rPos.y < 5) { rPos.y = 5; rVel.y = 0; }

            // HUD Update
            document.getElementById('rocket-group').setAttribute('position', `${rPos.x} ${rPos.y} ${rPos.z}`);
            document.getElementById('camera-rig').setAttribute('position', `${rPos.x} ${rPos.y+5} ${rPos.z+35}`);
            document.getElementById('fuel-display').innerText = Math.floor(stats.fuel);
            requestAnimationFrame(gameLoop);
        }

        // Button Listeners
        const bind = (id, prop) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); input[prop] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); input[prop] = false; });
        };
        bind('btn-up', 'fwd'); bind('btn-down', 'back'); bind('btn-left', 'left'); bind('btn-right', 'right'); bind('thrust-btn', 'thrust');
    </script>
</body>
</html>
