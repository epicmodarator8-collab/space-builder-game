<!DOCTYPE html>
<html>
<head>
    <title>Space Builder: Interstellar</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background: #000; color: white; }
        #build-screen { display: flex; flex-direction: column; height: 100vh; background: #050505; position: relative; z-index: 100; }
        #blueprint-area { flex-grow: 1; position: relative; background: radial-gradient(#1a1a1a 1px, transparent 1px) 0 0/25px 25px; border-bottom: 2px solid #00ff00; }
        #menu-container { height: 45%; display: flex; flex-direction: column; background: #111; }
        #parts-menu { flex-grow: 1; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .part-btn { background: #16213e; color: white; border: 1px solid #00ff00; padding: 10px; font-size: 11px; font-weight: bold; }
        .launch-btn { background: #008000; grid-column: span 2; padding: 15px; border: 1px solid white; font-size: 16px; font-weight: bold; }
        
        #hud { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 200; }
        .hud-panel { position: absolute; background: rgba(0,0,0,0.8); border: 1px solid #00ff00; pointer-events: auto; padding: 10px; border-radius: 5px; }
        #nav-status { top: 10px; right: 10px; text-align: right; }
        #resources { top: 10px; left: 10px; width: 150px; }
        .bar-bg { width: 100%; height: 8px; background: #222; margin-top: 4px; border-radius: 4px; overflow: hidden; }
        #map-toggle { bottom: 30px; left: 50%; transform: translateX(-50%); padding: 15px 30px; background: #0044ff; color: white; border: 2px solid white; font-weight: bold; border-radius: 5px; cursor: pointer; pointer-events: auto; }
        
        #controls { position: absolute; bottom: 30px; right: 20px; display: flex; flex-direction: column; gap: 10px; pointer-events: auto; }
        .ctrl-btn { width: 60px; height: 60px; background: #222; border: 2px solid #0f0; color: #0f0; font-weight: bold; }
    </style>
</head>
<body>

    <div id="build-screen">
        <div id="blueprint-area"><div style="padding:15px; font-weight: bold; color: #00ff00;">BUDGET: $<span id="cash">10100</span></div></div>
        <div id="menu-container">
            <div id="parts-menu">
                <button class="part-btn" onclick="addPart('capsule')">CAPSULE ($200)</button>
                <button class="part-btn" onclick="addPart('fuel')">HYPER FUEL ($800)</button>
                <button class="part-btn" onclick="addPart('engine')">WARP DRIVE ($1500)</button>
                <button class="part-btn launch-btn" onclick="launch()">IGNITION</button>
            </div>
        </div>
    </div>

    <div id="hud">
        <div id="resources" class="hud-panel">
            <div id="alt-text" style="color:#0f0">DIST: 0</div>
            <div class="bar-bg"><div id="fuel-fill" style="height:100%; width:100%; background:#f90"></div></div>
            <div class="bar-bg"><div id="o2-fill" style="height:100%; width:100%; background:#0cf"></div></div>
        </div>
        <div id="nav-status" class="hud-panel">
            <div id="view-mode" style="font-weight:bold; color:#00ff00">VIEW: ROCKET</div>
            <div id="location-mode" style="font-size:12px">ZONE: SOLAR SYSTEM</div>
        </div>
        <button id="map-toggle" onclick="toggleMap()">VIEW MAP</button>
        <div id="controls">
            <button class="ctrl-btn" onclick="thrust(1.5)">THRUST</button>
            <button class="ctrl-btn" onclick="thrust(-1.5)">BRAKE</button>
        </div>
    </div>

    <a-scene id="game-scene" style="display:none">
        <a-sky id="world-sky" color="#000"></a-sky>
        
        <a-entity id="galaxy-container">
            <a-sphere id="black-hole" position="0 0 -500000" radius="5000" color="#000" material="shader: flat;"></a-sphere>
            <a-ring id="bh-event-horizon" position="0 0 -500000" rotation="-90 0 0" radius-inner="6000" radius-outer="8000" color="#ffaa00" opacity="0.8"></a-ring>
            
            <a-entity id="star-cluster"></a-entity>
        </a-entity>

        <a-entity id="current-system">
            <a-sphere id="local-sun" position="0 0 -5000" radius="500" material="emissive: yellow;"></a-sphere>
            <a-sphere id="local-earth" position="0 -100 0" radius="100" color="#2244ff"></a-sphere>
            <a-ring id="local-orbit" position="0 0 -5000" rotation="-90 0 0" radius-inner="4990" radius-outer="5010" color="white" opacity="0.1" visible="false"></a-ring>
        </a-entity>

        <a-entity id="rocket-rig">
            <a-entity id="visual-stack"></a-entity>
        </a-entity>

        <a-entity id="cam-pivot">
            <a-entity id="cam-zoom" position="0 5 30"><a-camera look-controls="enabled:false"></a-camera></a-entity>
        </a-entity>
    </a-scene>

    <script>
        let stack = []; let active = false; let isMap = false;
        let pos = {x:0, y:5, z:0}; let vel = {x:0, y:0, z:0};
        let fuelCur = 5000; let fuelCap = 5000;

        function addPart(t) {
            let el = document.createElement('div'); el.className='placed-part';
            el.style.backgroundColor='#444'; el.style.height='30px'; el.style.bottom=(stack.length*30+10)+'px';
            el.style.position='absolute'; el.style.width='60px'; el.style.left='50%'; el.style.transform='translateX(-50%)';
            el.innerText=t.toUpperCase(); document.getElementById('blueprint-area').appendChild(el);
            stack.push(t);
        }

        function launch() {
            document.getElementById('build-screen').style.display = 'none';
            document.getElementById('game-scene').style.display = 'block';
            document.getElementById('hud').style.display = 'block';
            
            // Generate 30 Solar Systems
            const cluster = document.getElementById('star-cluster');
            for(let i=0; i<30; i++){
                let s = document.createElement('a-entity');
                let dist = 50000 + (i * 15000);
                let angle = (i / 30) * Math.PI * 2;
                let x = Math.cos(angle) * dist;
                let z = Math.sin(angle) * dist - 500000;
                
                s.innerHTML = `<a-sphere position="${x} 0 ${z}" radius="300" color="yellow"></a-sphere>
                               <a-ring position="0 0 -500000" rotation="-90 0 0" radius-inner="${dist-50}" radius-outer="${dist+50}" color="cyan" opacity="0.1" visible="false" class="gal-orbit"></a-ring>`;
                cluster.appendChild(s);
            }
            
            let v = document.getElementById('visual-stack');
            stack.forEach((t, i) => {
                let e = document.createElement('a-entity');
                e.setAttribute('geometry', `primitive:cylinder; radius:0.8; height:2`);
                e.setAttribute('material', `color:white`);
                e.setAttribute('position', `0 ${i*2} 0`);
                v.appendChild(e);
            });
            active = true; loop();
        }

        function toggleMap() {
            isMap = !isMap;
            const cam = document.getElementById('cam-zoom');
            const inGalaxy = Math.abs(pos.z) > 10000;
            
            // Toggle orbits based on scale
            document.getElementById('local-orbit').setAttribute('visible', isMap && !inGalaxy);
            document.querySelectorAll('.gal-orbit').forEach(o => o.setAttribute('visible', isMap && inGalaxy));

            if(isMap) {
                cam.setAttribute('position', inGalaxy ? '0 100000 0' : '0 5000 0');
                cam.setAttribute('rotation', '-90 0 0');
                document.getElementById('view-mode').innerText = "VIEW: MAP";
            } else {
                cam.setAttribute('position', '0 5 30');
                cam.setAttribute('rotation', '0 0 0');
                document.getElementById('view-mode').innerText = "VIEW: ROCKET";
            }
        }

        function thrust(v) { if(fuelCur > 0) { vel.z -= v; fuelCur -= 100; } }

        function loop() {
            if(!active) return;
            pos.z += vel.z;
            
            let distToBH = Math.abs(pos.z - (-500000));
            document.getElementById('alt-text').innerText = "Z-POS: " + Math.floor(pos.z);
            
            // Switch Logic: Solar System vs Galaxy
            if(Math.abs(pos.z) > 15000) {
                document.getElementById('location-mode').innerText = "ZONE: DEEP GALAXY";
                document.getElementById('current-system').setAttribute('visible', false);
            } else {
                document.getElementById('location-mode').innerText = "ZONE: SOLAR SYSTEM";
                document.getElementById('current-system').setAttribute('visible', true);
            }

            document.getElementById('fuel-fill').style.width = (fuelCur/fuelCap*100) + "%";
            document.getElementById('rocket-rig').setAttribute('position', `0 0 ${pos.z}`);
            document.getElementById('cam-pivot').setAttribute('position', `0 0 ${pos.z}`);
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
